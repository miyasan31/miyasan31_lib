# 単方向データバインディングと双方向データバインディング

- [データバインディング - Wiki](https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0)
- [React と Vue から単方向・双方向データバインディングの違いを知る](https://qiita.com/tamago3keran/items/590d99288dcccf388798)

## データバインディングとは？

データバインディング（データバインド、データ結合）は、データと対象を結びつけ、データあるいは対象の変更を暗示的にもう一方の変更へ反映すること、それを実現する仕組みのことである

## 単方向データバインディング

### React

- React は基本的に単方向データバインディング
- 双方向データバインディング用のヘルパーも用意されてるが、 v15 で非推奨になった
- イベントハンドラを設定しないといけない

```jsx
const InputText = () => {
  const [text, steText] = useState("");

  const handleChangeText = (e) => {
    setText(e.target.value);
  };

  return <input value={text} onChange={handleChangeText} />;
};
```

## 双方向データバインディング

### Vue

- Vue は双方向データバインディング
- イベントハンドラを実装しなくても、 View の変更がデータに自動的に反映される

```html
<div id="vue">
  <input type="text" v-model="value" />
  <p>state: {{value}}</p>
</div>
```

```javascript
new Vue({
  el: "#vue",
  data: {
    value: "",
  },
});
```

### Angular

- データバインディングによってバインドできる値のコンテキストはコンポーネントインスタンスで、 window や document といったグローバル名前空間内のものは参照できない

1. Interpolation

   **二重中括弧で囲んでテンプレートに記述すると、プロパティの値を文字列値としてテンプレート内に展開できる**

   ```html
   <!-- frameworkName = "Angular" -->
   <h1 class="red">Hello {{ frameworkName }} !!</h1>
   <input type="text" name="framework" value="{{ frameworkName }}" />
   ```

1. プロパティバインディング

   **ターゲット要素の DOM プロパティをブラケット [角括弧] で囲み、バインドする値を指定**

   - ターゲット要素の DOM プロパティをブラケット (角括弧) で囲み、バインドする値を指定します。

   ```html
   <!-- imgSrc = ./assets/image.jpg -->
   <img [src]="imgSrc" />

   <!-- idDisabled = true -->
   <button type="button" [disabled]="idDisabled">OK</button>
   ```

   > バインディングの対象は DOM プロパティであって、 HTML 属性ではない

1. 属性バインディング

   **ターゲット要素の HTML 属性をブラケット [角括弧] で囲み、属性名にドット (.) 付きの接頭辞 attr を付与して、バインドする属性値を指定**

   - DOM プロパティが存在せず、 HTML 属性しか存在しない場合は属性バインディングを使用

   ```html
   <table>
     <tr>
       <!-- colSpan = 2 -->
       <th [attr.colspan]="colSpan">Angular</th>
     </tr>
     <tr>
       <td>component</td>
       <td>template</td>
     </tr>
   </table>
   ```

1. クラスバインディング

   **ターゲット要素のクラス名をブラケット [角括弧] で囲み、ドット (.) 付きの接頭辞 class を付与して、バインドする値を指定**

   - バインドされた値は論理型 (boolean 型)として評価され、真 (true) の場合はクラスを追加、偽 (false) の場合はクラスが削除
   - プロパティバインディングでも class 属性に値をバインドできますが、元々指定されている静的な値が存在した場合はバインドした値で上書きされてしまう
   - クラスバインディングを使用すれば、 class 属性に必ず設定したい静的な値はそのままに、クラスの追加・削除を行うことが可能

   ```html
   <!-- bold = false -->
   <div class="red" [class.bold]="bold">Red and bold</div>

   <!-- divClass = { bold: true, blue: false } -->
   <div class="red" [class]="divClass">Bold only</div>
   ```

   ```css
   .red {
     color: #ff0000;
   }

   .bold {
     font-weight: bold;
   }

   .blue {
     color: #0000ff;
   }
   ```

1. スタイルバインディング

   **ターゲット要素のスタイルプロパティをブラケット (角括弧) で囲み、ドット (.) 付きの接頭辞 style を付与して、バインドする値を指定**

   ```javascript
   export class AppComponent {
     divHeight = "150px";
     divWidth = 300;

     divStyle = {
       width: "200px",
       height: "200px",
       backgroundColor: "#0000ff",
     };
   }
   ```

   ```html
   <!-- divWidth = 300, divHeight = "150px" -->
   <div [style.height]="divHeight" [style.width.px]="divWidth">
     Red rectangle
   </div>

   <!-- divStyle = { width: "200px", backgroundColor: "#0000ff" } -->
   <div [style]="divStyle">Blue square</div>
   ```

1. イベントバインディング

   **ターゲット要素のイベントを丸括弧で囲み、バインドする文を指定**

   - 一般的なイベントリスナーと同様に preventDefault() や stopPropagation() を使用して、デフォルト動作やバブリングをキャンセルすることが可能

   ```html
   <!-- showAlert(e: MouseEvent): void {} -->
   <button type="button" (click)="showAlert($event)">表示</button>
   ```

1. 双方向バインディング

   #### 基本的な書き方

   - プロパティバインディングとイベントバインディングのシンタックスシュガーで記述する

   ```html
   <input type="text" [value]="name" (input)="inputName($event.target.value)" />
   ```

   ```javascript
   export class ChildComponent {
     @Input() name: string;
     @Output() nameChange = new EventEmitter<string>();

     inputName(_name: string) {
       this.name = _name;
       this.nameChange.emit(this.name);
     }
   }
   ```

   #### NgModel ディレクティブ (FormsModule) を使用する場合

   > NgModel ディレクティブを使用するためには、 NgModule の imports リストに FormsModule を追加する必要があるので注意

   ```html
   <!-- yourName = 'miyasan' -->
   <input type="text" name="your_name" [(ngModel)]="yourName" />

   <span>Hello {{ yourName }} !!</span>
   ```
